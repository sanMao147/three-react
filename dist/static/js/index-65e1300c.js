import{j as e,a as t}from"./index-51a87768.js";import{r as n}from"./react-aa034a1c.js";import{S as a,P as s,W as o,A as i,w as r,H as d,V as c,I as p,J as w,K as h,a as l,i as m,O as g,u,Q as f,G as S,y as j,U as x,X as z,Y as v,Z as b,r as y,D as E,_ as A,s as M}from"./three-b38ba3aa.js";import{m as P}from"./d3-geo-53e87dce.js";import"./react-dom-67b4aaa0.js";import"./classnames-46b2866a.js";import"./scheduler-6fdbf8de.js";import"./react-router-dom-824b8f8a.js";import"./react-router-ca90130e.js";import"./@remix-run-f8738e57.js";import"./d3-array-7cca7373.js";const W=()=>{const W=P().center([104,37.5]).scale(80).translate([0,0]),[H,C]=n.useState(""),[D,F]=n.useState({left:"",top:""});let T=n.useRef(null),_=null,R=null,X=null;n.useEffect((()=>{Y()}),[]);const Y=async()=>{const e=await fetch("/json/china.json"),t=await e.json(),n={width:window.innerWidth,height:window.innerHeight};R=new a;const S=new s(75,n.width/n.height,1,5e3);S.position.set(0,-60,70),S.lookAt(0,0,0),R.add(S);const j=new o({canvas:T.current,antialias:!0});j.setPixelRatio(Math.min(window.devicePixelRatio,2)),j.setSize(n.width,n.height),j.toneMapping=i,j.shadowMap.enabled=!0,j.toneMappingExposure=1.25,j.outputEncoding=r,j.setClearColor(16777215,0);const x=new d({maxFar:1e3,cascades:4,mode:"practical",parent:R,shadowMapSize:1024,lightDirection:new c(-1,-1,-1).normalize(),camera:S}),z=new p(x);z.visible=!1,R.add(z);const v=new w({color:202807,metalness:0,roughness:1,opacity:.5,transparent:!0});_=new h,R.add(_);const b=new l(new m(2e3,2e3,1,1),v);b.position.z=0,b.receiveShadow=!0,R.add(b);const y=new g(S,T.current);y.target.set(0,0,0),y.enableDamping=!0,y.enablePan=!1,y.minPolarAngle=1,y.maxPolarAngle=1.6,y.minAzimuthAngle=-.2,y.maxAzimuthAngle=.2,y.maxDistance=250,$(t),k(),window.addEventListener("resize",(()=>{S.aspect=window.innerWidth/window.innerHeight,S.updateProjectionMatrix(),j.setSize(window.innerWidth,window.innerHeight)}),!1);const E=new u;let A=new f;window.addEventListener("mousemove",(e=>{A.x=e.clientX/window.innerWidth*2-1,A.y=-e.clientY/window.innerHeight*2+1,F({left:e.clientX+10+"px",top:e.clientY-20+"px"})}),!1);const M=()=>{if(y.update(),S.updateMatrixWorld(),x.update(),E&&X.children.length>0){E.setFromCamera(A,S);const e=E.intersectObjects(X.children);if(1===e.length){const t=e[0].object.parent.properties;C(t.name)}else C("")}j.render(R,S),requestAnimationFrame(M)};M()},$=e=>{X=new S;(new j).load(["/three-react/static/png/px-cb335eb9.png","/three-react/static/png/nx-7d0ddd41.png","/three-react/static/png/py-80a5d17d.png","/three-react/static/png/ny-2161698a.png","/three-react/static/png/pz-92089d82.png","/three-react/static/png/nz-253635ef.png"],(t=>{_.copy(x.fromCubeTexture(t)),e.features.forEach(((e,t)=>{const n=new z,{coordinates:a}=e.geometry,s=16777215*Math.random();if(a.forEach((e=>{e.forEach((e=>{const a=new v;for(let t=0;t<e.length;t++){let[n,s]=W(e[t]);0===t&&a.moveTo(n,-s),a.lineTo(n,-s)}const o=new b(a,{depth:4,bevelEnabled:!0,bevelSegments:1,bevelThickness:.2}),i=new w({color:s,metalness:1}),r=new w({color:s,metalness:1,roughness:1}),d=new l(o,[i,r]);t%2==0&&d.scale.set(1,1,1.2),d.castShadow=!0,d.receiveShadow=!0,d._color=s,n.add(d)}))})),n.properties=e.properties,e.properties.centroid){const[t,a]=W(e.properties.centroid);n.properties._centroid=[t,a]}X.add(n)})),R.environment=t,t.dispose(),R.add(X)}))},k=()=>{const e=new S;let t=new y(16777215,.2);const n=new E(16777215,.5);n.position.set(20,-50,20),n.castShadow=!0,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024;let a=new A("#80edff","#75baff",.3);a.position.set(20,-50,0);const s=new M(16777215,.5);s.position.set(20,-50,50),s.castShadow=!0,s.shadow.mapSize.width=1024,s.shadow.mapSize.height=1024;const o=new M(16777215,.5);o.position.set(50,-50,20),o.castShadow=!0,o.shadow.mapSize.width=1024,o.shadow.mapSize.height=1024;const i=new M(16777215,.5);i.position.set(-50,-50,20),i.castShadow=!0,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,e.add(t,i,n,s,o,a),R.add(e)},L={position:"absolute",top:`${D.top}`,left:`${D.left}`,color:"#000",userSelect:"none"};return e("div",{style:{position:"relative"},children:[t("div",{style:L,children:H}),t("canvas",{ref:T})]})};export{W as default};
