import{j as e,a as t}from"./index-c24a0b49.js";import{V as n,S as o,P as a,W as r,A as i,O as s,T as c,w as l,x as m,o as d,a as p}from"./three-925ba127.js";import{g as w}from"./gsap-cfe403f7.js";import{r as h}from"./react-aa034a1c.js";import"./react-dom-67b4aaa0.js";import"./classnames-46b2866a.js";import"./scheduler-6fdbf8de.js";import"./react-router-dom-824b8f8a.js";import"./react-router-ca90130e.js";import"./@remix-run-f8738e57.js";const u=[{name:"客厅",key:"living-room",map:new URL("/three-react/static/jpg/ballroom-eeef41c9.jpg",self.location).href,showSwitch:!0,position:new n(0,0,0)},{name:"卧室",key:"bed-room",map:new URL("/three-react/static/jpg/lythwood-2cd87567.jpg",self.location).href,showSwitch:!0,position:new n(-32,0,0)},{name:"室内泳池",key:"pool-room",map:new URL("/three-react/static/jpg/pool-bb02d197.jpg",self.location).href,showSwitch:!0,position:new n(32,0,0)}],g=()=>{let n=h.useRef(null);const[g,y]=h.useState({renderer:null,camera:null,scene:null,controls:null,cameraZAxis:2,animationId:null,currentRoom:"living-room"});h.useEffect((()=>(f(),x())),[]);const x=()=>{g.camera&&(cancelAnimationFrame(g.animationId),g.scene.traverse((e=>{e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose(),e=null})),g.renderer.forceContextLoss(),g.renderer.dispose(),g.scene.clear(),g.scene=null,g.camera=null,g.controls=null,g.renderer.domElement=null,g.renderer=null)},f=()=>{const e={width:window.innerWidth,height:window.innerHeight},t=new o,w=new a(75,e.width/e.height,1,1e3);w.position.z=g.cameraZAxis,t.add(w);const h=new r({canvas:n.current,antialias:!0});h.setPixelRatio(Math.min(window.devicePixelRatio,2)),h.setSize(e.width,e.height),h.toneMapping=i;const x=new s(w,n.current);x.target.set(0,0,0),x.enableDamping=!0,x.enablePan=!1,y((e=>({...e,scene:t,camera:w,renderer:h,controls:x}))),window.addEventListener("resize",(()=>{w.aspect=window.innerWidth/window.innerHeight,w.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}),!1),u.map((e=>((e,n,o)=>{const a=new c,r=new l(16,256,256);r.scale(1,1,-1);const i=new m({map:a.load(o),side:d}),s=new p(r,i);return s.name=e,s.position.set(n.x,n.y,n.z),s.rotation.y=Math.PI/2,t.add(s),s})(e.key,e.position,e.map)));const f=()=>{x.update(),h.render(t,w);let e=requestAnimationFrame(f);y((t=>({...t,animationId:e})))};f()};return e("div",{className:"housepage",children:[t("canvas",{ref:n}),t("div",{className:"vr",children:e("span",{className:"box",children:[t("i",{className:"icon"}),t("b",{className:"text",children:"全景看房"})]})}),t("div",{className:"switch",children:u.map((n=>n.key!==g.currentRoom?e("span",{className:"button",onClick:()=>(async e=>{const t=u.filter((t=>t.key===e))[0];if(g.camera){const e=t.position.x,n=t.position.y,o=t.position.z;let a={x1:g.camera.position.x,y1:g.camera.position.y,z1:g.camera.position.z,x2:g.controls.target.x,y2:g.controls.target.y,z2:g.controls.target.z};w.to(a,{x1:e,y1:n,z1:2,x2:e,y2:n,z2:o,duration:1.2,ease:"power1.out",onComplete:()=>{g.controls.enabled=!0},onUpdate:()=>{g.camera.position.x=a.x1,g.camera.position.y=a.y1,g.camera.position.z=a.z1,g.controls.target.x=a.x2,g.controls.target.y=a.y2,g.controls.target.z=a.z2,g.controls.update()}})}y((e=>({...e,currentRoom:t.key})))})(n.key),children:[t("b",{className:"text",children:n.name}),t("i",{className:"icon"})]},n.key):""))})]})};export{g as default};
