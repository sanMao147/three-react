import{r as e}from"./react-aa034a1c.js";import{e as t,c as n,f as r,i,j as a,b as s,h as o,g as u,k as l,l as c,a as d,m as f,_ as g,d as v}from"./@babel-ebff8eee.js";import{a as h,m,n as p,t as F}from"./rc-util-fd3bf20b.js";import{S as y}from"./async-validator-455bc203.js";var V="RC_FORM_INTERNAL_HOOKS",b=function(){h(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},E=e.createContext({getFieldValue:b,getFieldsValue:b,getFieldError:b,getFieldWarning:b,getFieldsError:b,isFieldsTouched:b,isFieldTouched:b,isFieldValidating:b,isFieldsValidating:b,resetFields:b,setFields:b,setFieldValue:b,setFieldsValue:b,validateFields:b,submit:b,getInternalHooks:function(){return b(),{dispatch:b,initEntityValue:b,registerField:b,useSubscribe:b,setInitialValues:b,destroyForm:b,setCallbacks:b,registerWatch:b,getFields:b,setValidateMessages:b,setPreserve:b,getInitialValue:b}}});function k(e){return null==e?[]:Array.isArray(e)?e:[e]}var P="'${name}' is not a valid ${type}",w={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:P,method:P,array:P,object:P,number:P,date:P,boolean:P,integer:P,float:P,regexp:P,email:P,url:P,hex:P},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}};function C(e){return Array.isArray(e)?e.map((function(e){return C(e)})):"object"===t(e)&&null!==e?function(e){if(Object.getPrototypeOf(e)===Object.prototype){var t={};for(var n in e)t[n]=C(e[n]);return t}return e}(e):e}function x(e){return k(e)}function N(e,t){return m(e,t)}function M(e,t,n){return p(e,t,n,arguments.length>3&&void 0!==arguments[3]&&arguments[3])}function I(e,t){var n={};return t.forEach((function(t){var r=N(e,t);n=M(n,t,r)})),n}function R(e,t){return e&&e.some((function(e){return S(e,t)}))}function $(e){return"object"===t(e)&&null!==e&&Object.getPrototypeOf(e)===Object.prototype}function O(e,t){var i=Array.isArray(e)?n(e):r({},e);return t?(Object.keys(t).forEach((function(e){var n=i[e],r=t[e],a=$(n)&&$(r);i[e]=a?O(n,r||{}):C(r)})),i):i}function A(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((function(e,t){return O(e,t)}),e)}function S(e,t){return!(!e||!t||e.length!==t.length)&&e.every((function(e,n){return t[n]===e}))}function U(e){var n=arguments.length<=1?void 0:arguments[1];return n&&n.target&&"object"===t(n.target)&&e in n.target?n.target[e]:n}function j(e,t,r){var i=e.length;if(t<0||t>=i||r<0||r>=i)return e;var a=e[t],s=t-r;return s>0?[].concat(n(e.slice(0,r)),[a],n(e.slice(r,t)),n(e.slice(t+1,i))):s<0?[].concat(n(e.slice(0,t)),n(e.slice(t+1,r+1)),[a],n(e.slice(r+1,i))):e}var T=y;function L(e,t){return e.replace(/\$\{\w+\}/g,(function(e){var n=e.slice(2,-1);return t[n]}))}var W="CODE_LOGIC_ERROR";function _(e,t,n,r,i){return H.apply(this,arguments)}function H(){return H=i(a().mark((function t(i,o,u,l,c){var d,f,g,v,h,m,p,F,y;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return delete(d=r({},u)).ruleIndex,d.validator&&(f=d.validator,d.validator=function(){try{return f.apply(void 0,arguments)}catch(e){return Promise.reject(W)}}),g=null,d&&"array"===d.type&&d.defaultField&&(g=d.defaultField,delete d.defaultField),v=new T(s({},i,[d])),h=A({},w,l.validateMessages),v.messages(h),m=[],t.prev=9,t.next=12,Promise.resolve(v.validate(s({},i,o),r({},l)));case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(9),t.t0.errors&&(m=t.t0.errors.map((function(t,n){var r=t.message,i=r===W?h.default:r;return e.isValidElement(i)?e.cloneElement(i,{key:"error_".concat(n)}):i})));case 17:if(m.length||!g){t.next=22;break}return t.next=20,Promise.all(o.map((function(e,t){return _("".concat(i,".").concat(t),e,g,l,c)})));case 20:return p=t.sent,t.abrupt("return",p.reduce((function(e,t){return[].concat(n(e),n(t))}),[]));case 22:return F=r(r({},u),{},{name:i,enum:(u.enum||[]).join(", ")},c),y=m.map((function(e){return"string"==typeof e?L(e,F):e})),t.abrupt("return",y);case 25:case"end":return t.stop()}}),t,null,[[9,14]])}))),H.apply(this,arguments)}function D(e,t,n,s,o,u){var l,c,d=e.join("."),f=n.map((function(e,t){var n=e.validator,i=r(r({},e),{},{ruleIndex:t});return n&&(i.validator=function(e,t,r){var i=!1,a=n(e,t,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Promise.resolve().then((function(){h(!i,"Your validator function has already return a promise. `callback` will be ignored."),i||r.apply(void 0,t)}))}));i=a&&"function"==typeof a.then&&"function"==typeof a.catch,h(i,"`callback` is deprecated. Please return a promise instead."),i&&a.then((function(){r()})).catch((function(e){r(e||" ")}))}),i})).sort((function(e,t){var n=e.warningOnly,r=e.ruleIndex,i=t.warningOnly,a=t.ruleIndex;return!!n==!!i?r-a:n?1:-1}));if(!0===o)l=new Promise((c=i(a().mark((function e(n,r){var i,o,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=0;case 1:if(!(i<f.length)){e.next=12;break}return o=f[i],e.next=5,_(d,t,o,s,u);case 5:if(!(l=e.sent).length){e.next=9;break}return r([{errors:l,rule:o}]),e.abrupt("return");case 9:i+=1,e.next=1;break;case 12:n([]);case 13:case"end":return e.stop()}}),e)}))),function(e,t){return c.apply(this,arguments)}));else{var g=f.map((function(e){return _(d,t,e,s,u).then((function(t){return{errors:t,rule:e}}))}));l=(o?function(e){return z.apply(this,arguments)}(g):function(e){return q.apply(this,arguments)}(g)).then((function(e){return Promise.reject(e)}))}return l.catch((function(e){return e})),l}function q(){return(q=i(a().mark((function e(t){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t).then((function(e){var t;return(t=[]).concat.apply(t,n(e))})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return(z=i(a().mark((function e(t){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=0,e.abrupt("return",new Promise((function(e){t.forEach((function(r){r.then((function(r){r.errors.length&&e([r]),(n+=1)===t.length&&e([])}))}))})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var J=["name"],K=[];function B(e,t,n,r,i,a){return"function"==typeof e?e(t,n,"source"in a?{source:a.source}:{}):r!==i}var G=function(t){l(a,t);var i=c(a);function a(t){var o;return d(this,a),(o=i.call(this,t)).state={resetCount:0},o.cancelRegisterFunc=null,o.mounted=!1,o.touched=!1,o.dirty=!1,o.validatePromise=void 0,o.prevValidating=void 0,o.errors=K,o.warnings=K,o.cancelRegister=function(){var e=o.props,t=e.preserve,n=e.isListField,r=e.name;o.cancelRegisterFunc&&o.cancelRegisterFunc(n,t,x(r)),o.cancelRegisterFunc=null},o.getNamePath=function(){var e=o.props,t=e.name,r=e.fieldContext.prefixName;return void 0!==t?[].concat(n(void 0===r?[]:r),n(t)):[]},o.getRules=function(){var e=o.props,t=e.rules,n=void 0===t?[]:t,r=e.fieldContext;return n.map((function(e){return"function"==typeof e?e(r):e}))},o.refresh=function(){o.mounted&&o.setState((function(e){return{resetCount:e.resetCount+1}}))},o.triggerMetaEvent=function(e){var t=o.props.onMetaChange;null==t||t(r(r({},o.getMeta()),{},{destroy:e}))},o.onStoreChange=function(e,t,n){var r=o.props,i=r.shouldUpdate,a=r.dependencies,s=void 0===a?[]:a,u=r.onReset,l=n.store,c=o.getNamePath(),d=o.getValue(e),f=o.getValue(l),g=t&&R(t,c);switch("valueUpdate"===n.type&&"external"===n.source&&d!==f&&(o.touched=!0,o.dirty=!0,o.validatePromise=null,o.errors=K,o.warnings=K,o.triggerMetaEvent()),n.type){case"reset":if(!t||g)return o.touched=!1,o.dirty=!1,o.validatePromise=null,o.errors=K,o.warnings=K,o.triggerMetaEvent(),null==u||u(),void o.refresh();break;case"remove":if(i)return void o.reRender();break;case"setField":if(g){var v=n.data;return"touched"in v&&(o.touched=v.touched),"validating"in v&&!("originRCField"in v)&&(o.validatePromise=v.validating?Promise.resolve([]):null),"errors"in v&&(o.errors=v.errors||K),"warnings"in v&&(o.warnings=v.warnings||K),o.dirty=!0,o.triggerMetaEvent(),void o.reRender()}if(i&&!c.length&&B(i,e,l,d,f,n))return void o.reRender();break;case"dependenciesUpdate":if(s.map(x).some((function(e){return R(n.relatedFields,e)})))return void o.reRender();break;default:if(g||(!s.length||c.length||i)&&B(i,e,l,d,f,n))return void o.reRender()}!0===i&&o.reRender()},o.validateRules=function(e){var t=o.getNamePath(),r=o.getValue(),i=Promise.resolve().then((function(){if(!o.mounted)return[];var a=o.props,s=a.validateFirst,u=void 0!==s&&s,l=a.messageVariables,c=(e||{}).triggerName,d=o.getRules();c&&(d=d.filter((function(e){return e})).filter((function(e){var t=e.validateTrigger;return!t||k(t).includes(c)})));var f=D(t,r,d,e,u,l);return f.catch((function(e){return e})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;if(o.validatePromise===i){var t;o.validatePromise=null;var r=[],a=[];null===(t=e.forEach)||void 0===t||t.call(e,(function(e){var t=e.rule.warningOnly,i=e.errors,s=void 0===i?K:i;t?a.push.apply(a,n(s)):r.push.apply(r,n(s))})),o.errors=r,o.warnings=a,o.triggerMetaEvent(),o.reRender()}})),f}));return o.validatePromise=i,o.dirty=!0,o.errors=K,o.warnings=K,o.triggerMetaEvent(),o.reRender(),i},o.isFieldValidating=function(){return!!o.validatePromise},o.isFieldTouched=function(){return o.touched},o.isFieldDirty=function(){return!(!o.dirty&&void 0===o.props.initialValue)||void 0!==(0,o.props.fieldContext.getInternalHooks(V).getInitialValue)(o.getNamePath())},o.getErrors=function(){return o.errors},o.getWarnings=function(){return o.warnings},o.isListField=function(){return o.props.isListField},o.isList=function(){return o.props.isList},o.isPreserve=function(){return o.props.preserve},o.getMeta=function(){return o.prevValidating=o.isFieldValidating(),{touched:o.isFieldTouched(),validating:o.prevValidating,errors:o.errors,warnings:o.warnings,name:o.getNamePath(),validated:null===o.validatePromise}},o.getOnlyChild=function(t){if("function"==typeof t){var n=o.getMeta();return r(r({},o.getOnlyChild(t(o.getControlled(),n,o.props.fieldContext))),{},{isFunction:!0})}var i=F(t);return 1===i.length&&e.isValidElement(i[0])?{child:i[0],isFunction:!1}:{child:i,isFunction:!1}},o.getValue=function(e){var t=o.props.fieldContext.getFieldsValue,n=o.getNamePath();return N(e||t(!0),n)},o.getControlled=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=o.props,n=t.trigger,i=t.validateTrigger,a=t.getValueFromEvent,u=t.normalize,l=t.valuePropName,c=t.getValueProps,d=t.fieldContext,f=void 0!==i?i:d.validateTrigger,g=o.getNamePath(),v=d.getInternalHooks,h=d.getFieldsValue,m=v(V).dispatch,p=o.getValue(),F=c||function(e){return s({},l,e)},y=e[n],b=r(r({},e),F(p));return b[n]=function(){var e;o.touched=!0,o.dirty=!0,o.triggerMetaEvent();for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];e=a?a.apply(void 0,n):U.apply(void 0,[l].concat(n)),u&&(e=u(e,p,h(!0))),m({type:"updateValue",namePath:g,value:e}),y&&y.apply(void 0,n)},k(f||[]).forEach((function(e){var t=b[e];b[e]=function(){t&&t.apply(void 0,arguments);var n=o.props.rules;n&&n.length&&m({type:"validateField",namePath:g,triggerName:e})}})),b},t.fieldContext&&(0,(0,t.fieldContext.getInternalHooks)(V).initEntityValue)(f(o)),o}return g(a,[{key:"componentDidMount",value:function(){var e=this.props,t=e.shouldUpdate,n=e.fieldContext;if(this.mounted=!0,n){var r=(0,n.getInternalHooks)(V).registerField;this.cancelRegisterFunc=r(this)}!0===t&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var t,n=this.state.resetCount,r=this.props.children,i=this.getOnlyChild(r),a=i.child;return i.isFunction?t=a:e.isValidElement(a)?t=e.cloneElement(a,this.getControlled(a.props)):(h(!a,"`children` of Field is not validate ReactElement."),t=a),e.createElement(e.Fragment,{key:n},t)}}]),a}(e.Component);function Y(t){var n=t.name,r=o(t,J),i=e.useContext(E),a=void 0!==n?x(n):void 0,s="keep";return r.isListField||(s="_".concat((a||[]).join("_"))),e.createElement(G,u({key:s,name:a},r,{fieldContext:i}))}G.contextType=E,G.defaultProps={trigger:"onChange",valuePropName:"value"};var Q=e.createContext(null),X="__@field_split__";function Z(e){return e.map((function(e){return"".concat(t(e),":").concat(e)})).join(X)}var ee=function(){function e(){d(this,e),this.kvs=new Map}return g(e,[{key:"set",value:function(e,t){this.kvs.set(Z(e),t)}},{key:"get",value:function(e){return this.kvs.get(Z(e))}},{key:"update",value:function(e,t){var n=t(this.get(e));n?this.set(e,n):this.delete(e)}},{key:"delete",value:function(e){this.kvs.delete(Z(e))}},{key:"map",value:function(e){return n(this.kvs.entries()).map((function(t){var n=v(t,2),r=n[0],i=n[1],a=r.split(X);return e({key:a.map((function(e){var t=e.match(/^([^:]*):(.*)$/),n=v(t,3),r=n[1],i=n[2];return"number"===r?Number(i):i})),value:i})}))}},{key:"toJSON",value:function(){var e={};return this.map((function(t){var n=t.key,r=t.value;return e[n.join(".")]=r,null})),e}}]),e}(),te=["name","errors"],ne=g((function e(t){var i=this;d(this,e),this.formHooked=!1,this.forceRootUpdate=void 0,this.subscribable=!0,this.store={},this.fieldEntities=[],this.initialValues={},this.callbacks={},this.validateMessages=null,this.preserve=null,this.lastValidatePromise=null,this.getForm=function(){return{getFieldValue:i.getFieldValue,getFieldsValue:i.getFieldsValue,getFieldError:i.getFieldError,getFieldWarning:i.getFieldWarning,getFieldsError:i.getFieldsError,isFieldsTouched:i.isFieldsTouched,isFieldTouched:i.isFieldTouched,isFieldValidating:i.isFieldValidating,isFieldsValidating:i.isFieldsValidating,resetFields:i.resetFields,setFields:i.setFields,setFieldValue:i.setFieldValue,setFieldsValue:i.setFieldsValue,validateFields:i.validateFields,submit:i.submit,_init:!0,getInternalHooks:i.getInternalHooks}},this.getInternalHooks=function(e){return e===V?(i.formHooked=!0,{dispatch:i.dispatch,initEntityValue:i.initEntityValue,registerField:i.registerField,useSubscribe:i.useSubscribe,setInitialValues:i.setInitialValues,destroyForm:i.destroyForm,setCallbacks:i.setCallbacks,setValidateMessages:i.setValidateMessages,getFields:i.getFields,setPreserve:i.setPreserve,getInitialValue:i.getInitialValue,registerWatch:i.registerWatch}):(h(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)},this.useSubscribe=function(e){i.subscribable=e},this.prevWithoutPreserves=null,this.setInitialValues=function(e,t){if(i.initialValues=e||{},t){var n,r=A({},e,i.store);null===(n=i.prevWithoutPreserves)||void 0===n||n.map((function(t){var n=t.key;r=M(r,n,N(e,n))})),i.prevWithoutPreserves=null,i.updateStore(r)}},this.destroyForm=function(){var e=new ee;i.getFieldEntities(!0).forEach((function(t){i.isMergedPreserve(t.isPreserve())||e.set(t.getNamePath(),!0)})),i.prevWithoutPreserves=e},this.getInitialValue=function(e){var t=N(i.initialValues,e);return e.length?C(t):t},this.setCallbacks=function(e){i.callbacks=e},this.setValidateMessages=function(e){i.validateMessages=e},this.setPreserve=function(e){i.preserve=e},this.watchList=[],this.registerWatch=function(e){return i.watchList.push(e),function(){i.watchList=i.watchList.filter((function(t){return t!==e}))}},this.notifyWatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(i.watchList.length){var t=i.getFieldsValue();i.watchList.forEach((function(n){n(t,e)}))}},this.timeoutId=null,this.warningUnhooked=function(){},this.updateStore=function(e){i.store=e},this.getFieldEntities=function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?i.fieldEntities.filter((function(e){return e.getNamePath().length})):i.fieldEntities},this.getFieldsMap=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ee;return i.getFieldEntities(e).forEach((function(e){var n=e.getNamePath();t.set(n,e)})),t},this.getFieldEntitiesForNamePathList=function(e){if(!e)return i.getFieldEntities(!0);var t=i.getFieldsMap(!0);return e.map((function(e){var n=x(e);return t.get(n)||{INVALIDATE_NAME_PATH:x(e)}}))},this.getFieldsValue=function(e,t){if(i.warningUnhooked(),!0===e&&!t)return i.store;var n=i.getFieldEntitiesForNamePathList(Array.isArray(e)?e:null),r=[];return n.forEach((function(n){var i,a="INVALIDATE_NAME_PATH"in n?n.INVALIDATE_NAME_PATH:n.getNamePath();if(e||!(null===(i=n.isListField)||void 0===i?void 0:i.call(n)))if(t){var s="getMeta"in n?n.getMeta():null;t(s)&&r.push(a)}else r.push(a)})),I(i.store,r.map(x))},this.getFieldValue=function(e){i.warningUnhooked();var t=x(e);return N(i.store,t)},this.getFieldsError=function(e){return i.warningUnhooked(),i.getFieldEntitiesForNamePathList(e).map((function(t,n){return t&&!("INVALIDATE_NAME_PATH"in t)?{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}:{name:x(e[n]),errors:[],warnings:[]}}))},this.getFieldError=function(e){i.warningUnhooked();var t=x(e);return i.getFieldsError([t])[0].errors},this.getFieldWarning=function(e){i.warningUnhooked();var t=x(e);return i.getFieldsError([t])[0].warnings},this.isFieldsTouched=function(){i.warningUnhooked();for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a,s=t[0],o=t[1],u=!1;0===t.length?a=null:1===t.length?Array.isArray(s)?(a=s.map(x),u=!1):(a=null,u=s):(a=s.map(x),u=o);var l=i.getFieldEntities(!0),c=function(e){return e.isFieldTouched()};if(!a)return u?l.every(c):l.some(c);var d=new ee;a.forEach((function(e){d.set(e,[])})),l.forEach((function(e){var t=e.getNamePath();a.forEach((function(r){r.every((function(e,n){return t[n]===e}))&&d.update(r,(function(t){return[].concat(n(t),[e])}))}))}));var f=function(e){return e.some(c)},g=d.map((function(e){return e.value}));return u?g.every(f):g.some(f)},this.isFieldTouched=function(e){return i.warningUnhooked(),i.isFieldsTouched([e])},this.isFieldsValidating=function(e){i.warningUnhooked();var t=i.getFieldEntities();if(!e)return t.some((function(e){return e.isFieldValidating()}));var n=e.map(x);return t.some((function(e){var t=e.getNamePath();return R(n,t)&&e.isFieldValidating()}))},this.isFieldValidating=function(e){return i.warningUnhooked(),i.isFieldsValidating([e])},this.resetWithFieldInitialValue=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new ee,a=i.getFieldEntities(!0);a.forEach((function(e){var t=e.props.initialValue,n=e.getNamePath();if(void 0!==t){var i=r.get(n)||new Set;i.add({entity:e,value:t}),r.set(n,i)}})),t.entities?e=t.entities:t.namePathList?(e=[],t.namePathList.forEach((function(t){var i,a=r.get(t);a&&(i=e).push.apply(i,n(n(a).map((function(e){return e.entity}))))}))):e=a,e.forEach((function(e){if(void 0!==e.props.initialValue){var a=e.getNamePath();if(void 0!==i.getInitialValue(a))h(!1,"Form already set 'initialValues' with path '".concat(a.join("."),"'. Field can not overwrite it."));else{var s=r.get(a);if(s&&s.size>1)h(!1,"Multiple Field with path '".concat(a.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(s){var o=i.getFieldValue(a);t.skipExist&&void 0!==o||i.updateStore(M(i.store,a,n(s)[0].value))}}}}))},this.resetFields=function(e){i.warningUnhooked();var t=i.store;if(!e)return i.updateStore(A({},i.initialValues)),i.resetWithFieldInitialValue(),i.notifyObservers(t,null,{type:"reset"}),void i.notifyWatch();var n=e.map(x);n.forEach((function(e){var t=i.getInitialValue(e);i.updateStore(M(i.store,e,t))})),i.resetWithFieldInitialValue({namePathList:n}),i.notifyObservers(t,n,{type:"reset"}),i.notifyWatch(n)},this.setFields=function(e){i.warningUnhooked();var t=i.store,n=[];e.forEach((function(e){var r=e.name;e.errors;var a=o(e,te),s=x(r);n.push(s),"value"in a&&i.updateStore(M(i.store,s,a.value)),i.notifyObservers(t,[s],{type:"setField",data:e})})),i.notifyWatch(n)},this.getFields=function(){return i.getFieldEntities(!0).map((function(e){var t=e.getNamePath(),n=e.getMeta(),a=r(r({},n),{},{name:t,value:i.getFieldValue(t)});return Object.defineProperty(a,"originRCField",{value:!0}),a}))},this.initEntityValue=function(e){var t=e.props.initialValue;if(void 0!==t){var n=e.getNamePath();void 0===N(i.store,n)&&i.updateStore(M(i.store,n,t))}},this.isMergedPreserve=function(e){var t=void 0!==e?e:i.preserve;return null==t||t},this.registerField=function(e){i.fieldEntities.push(e);var t=e.getNamePath();if(i.notifyWatch([t]),void 0!==e.props.initialValue){var n=i.store;i.resetWithFieldInitialValue({entities:[e],skipExist:!0}),i.notifyObservers(n,[e.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(n,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(i.fieldEntities=i.fieldEntities.filter((function(t){return t!==e})),!i.isMergedPreserve(r)&&(!n||a.length>1)){var s=n?void 0:i.getInitialValue(t);if(t.length&&i.getFieldValue(t)!==s&&i.fieldEntities.every((function(e){return!S(e.getNamePath(),t)}))){var o=i.store;i.updateStore(M(o,t,s,!0)),i.notifyObservers(o,[t],{type:"remove"}),i.triggerDependenciesUpdate(o,t)}}i.notifyWatch([t])}},this.dispatch=function(e){switch(e.type){case"updateValue":var t=e.namePath,n=e.value;i.updateValue(t,n);break;case"validateField":var r=e.namePath,a=e.triggerName;i.validateFields([r],{triggerName:a})}},this.notifyObservers=function(e,t,n){if(i.subscribable){var a=r(r({},n),{},{store:i.getFieldsValue(!0)});i.getFieldEntities().forEach((function(n){(0,n.onStoreChange)(e,t,a)}))}else i.forceRootUpdate()},this.triggerDependenciesUpdate=function(e,t){var r=i.getDependencyChildrenFields(t);return r.length&&i.validateFields(r),i.notifyObservers(e,r,{type:"dependenciesUpdate",relatedFields:[t].concat(n(r))}),r},this.updateValue=function(e,t){var r=x(e),a=i.store;i.updateStore(M(i.store,r,t)),i.notifyObservers(a,[r],{type:"valueUpdate",source:"internal"}),i.notifyWatch([r]);var s=i.triggerDependenciesUpdate(a,r),o=i.callbacks.onValuesChange;o&&o(I(i.store,[r]),i.getFieldsValue()),i.triggerOnFieldsChange([r].concat(n(s)))},this.setFieldsValue=function(e){i.warningUnhooked();var t=i.store;if(e){var n=A(i.store,e);i.updateStore(n)}i.notifyObservers(t,null,{type:"valueUpdate",source:"external"}),i.notifyWatch()},this.setFieldValue=function(e,t){i.setFields([{name:e,value:t}])},this.getDependencyChildrenFields=function(e){var t=new Set,n=[],r=new ee;return i.getFieldEntities().forEach((function(e){(e.props.dependencies||[]).forEach((function(t){var n=x(t);r.update(n,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return t.add(e),t}))}))})),function e(i){(r.get(i)||new Set).forEach((function(r){if(!t.has(r)){t.add(r);var i=r.getNamePath();r.isFieldDirty()&&i.length&&(n.push(i),e(i))}}))}(e),n},this.triggerOnFieldsChange=function(e,t){var n=i.callbacks.onFieldsChange;if(n){var r=i.getFields();if(t){var a=new ee;t.forEach((function(e){var t=e.name,n=e.errors;a.set(t,n)})),r.forEach((function(e){e.errors=a.get(e.name)||e.errors}))}n(r.filter((function(t){var n=t.name;return R(e,n)})),r)}},this.validateFields=function(e,t){i.warningUnhooked();var a=!!e,s=a?e.map(x):[],o=[];i.getFieldEntities(!0).forEach((function(u){if(a||s.push(u.getNamePath()),(null==t?void 0:t.recursive)&&a){var l=u.getNamePath();l.every((function(t,n){return e[n]===t||void 0===e[n]}))&&s.push(l)}if(u.props.rules&&u.props.rules.length){var c=u.getNamePath();if(!a||R(s,c)){var d=u.validateRules(r({validateMessages:r(r({},w),i.validateMessages)},t));o.push(d.then((function(){return{name:c,errors:[],warnings:[]}})).catch((function(e){var t,r=[],i=[];return null===(t=e.forEach)||void 0===t||t.call(e,(function(e){var t=e.rule.warningOnly,a=e.errors;t?i.push.apply(i,n(a)):r.push.apply(r,n(a))})),r.length?Promise.reject({name:c,errors:r,warnings:i}):{name:c,errors:r,warnings:i}})))}}}));var u,l,c,d,f=(l=!1,c=(u=o).length,d=[],u.length?new Promise((function(e,t){u.forEach((function(n,r){n.catch((function(e){return l=!0,e})).then((function(n){c-=1,d[r]=n,c>0||(l&&t(d),e(d))}))}))})):Promise.resolve([]));i.lastValidatePromise=f,f.catch((function(e){return e})).then((function(e){var t=e.map((function(e){return e.name}));i.notifyObservers(i.store,t,{type:"validateFinish"}),i.triggerOnFieldsChange(t,e)}));var g=f.then((function(){return i.lastValidatePromise===f?Promise.resolve(i.getFieldsValue(s)):Promise.reject([])})).catch((function(e){var t=e.filter((function(e){return e&&e.errors.length}));return Promise.reject({values:i.getFieldsValue(s),errorFields:t,outOfDate:i.lastValidatePromise!==f})}));return g.catch((function(e){return e})),g},this.submit=function(){i.warningUnhooked(),i.validateFields().then((function(e){var t=i.callbacks.onFinish;if(t)try{t(e)}catch(n){}})).catch((function(e){var t=i.callbacks.onFinishFailed;t&&t(e)}))},this.forceRootUpdate=t}));function re(t){var n=e.useRef(),r=e.useState({}),i=v(r,2)[1];if(!n.current)if(t)n.current=t;else{var a=new ne((function(){i({})}));n.current=a.getForm()}return[n.current]}var ie=e.createContext({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),ae=function(t){var n=t.validateMessages,i=t.onFormChange,a=t.onFormFinish,o=t.children,u=e.useContext(ie),l=e.useRef({});return e.createElement(ie.Provider,{value:r(r({},u),{},{validateMessages:r(r({},u.validateMessages),n),triggerFormChange:function(e,t){i&&i(e,{changedFields:t,forms:l.current}),u.triggerFormChange(e,t)},triggerFormFinish:function(e,t){a&&a(e,{values:t,forms:l.current}),u.triggerFormFinish(e,t)},registerForm:function(e,t){e&&(l.current=r(r({},l.current),{},s({},e,t))),u.registerForm(e,t)},unregisterForm:function(e){var t=r({},l.current);delete t[e],l.current=t,u.unregisterForm(e)}})},o)},se=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"];function oe(e){try{return JSON.stringify(e)}catch(t){return Math.random()}}var ue=e.forwardRef((function(i,a){var s=i.name,l=i.initialValues,c=i.fields,d=i.form,f=i.preserve,g=i.children,h=i.component,m=void 0===h?"form":h,p=i.validateMessages,F=i.validateTrigger,y=void 0===F?"onChange":F,b=i.onValuesChange,k=i.onFieldsChange,P=i.onFinish,w=i.onFinishFailed,C=o(i,se),x=e.useContext(ie),N=re(d),M=v(N,1)[0],I=M.getInternalHooks(V),R=I.useSubscribe,$=I.setInitialValues,O=I.setCallbacks,A=I.setValidateMessages,S=I.setPreserve,U=I.destroyForm;e.useImperativeHandle(a,(function(){return M})),e.useEffect((function(){return x.registerForm(s,M),function(){x.unregisterForm(s)}}),[x,M,s]),A(r(r({},x.validateMessages),p)),O({onValuesChange:b,onFieldsChange:function(e){if(x.triggerFormChange(s,e),k){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];k.apply(void 0,[e].concat(n))}},onFinish:function(e){x.triggerFormFinish(s,e),P&&P(e)},onFinishFailed:w}),S(f);var j,T=e.useRef(null);$(l,!T.current),T.current||(T.current=!0),e.useEffect((function(){return U}),[]);var L="function"==typeof g;j=L?g(M.getFieldsValue(!0),M):g,R(!L);var W=e.useRef();e.useEffect((function(){(function(e,r){if(e===r)return!0;if(!e&&r||e&&!r)return!1;if(!e||!r||"object"!==t(e)||"object"!==t(r))return!1;var i=Object.keys(e),a=Object.keys(r),s=new Set([].concat(i,a));return n(s).every((function(t){var n=e[t],i=r[t];return"function"==typeof n&&"function"==typeof i||n===i}))})(W.current||[],c||[])||M.setFields(c||[]),W.current=c}),[c,M]);var _=e.useMemo((function(){return r(r({},M),{},{validateTrigger:y})}),[M,y]),H=e.createElement(E.Provider,{value:_},j);return!1===m?H:e.createElement(m,u({},C,{onSubmit:function(e){e.preventDefault(),e.stopPropagation(),M.submit()},onReset:function(e){var t;e.preventDefault(),M.resetFields(),null===(t=C.onReset)||void 0===t||t.call(C,e)}}),H)}));ue.FormProvider=ae,ue.Field=Y,ue.List=function(t){var i=t.name,a=t.initialValue,s=t.children,o=t.rules,u=t.validateTrigger,l=e.useContext(E),c=e.useRef({keys:[],id:0}).current,d=e.useMemo((function(){var e=x(l.prefixName)||[];return[].concat(n(e),n(x(i)))}),[l.prefixName,i]),f=e.useMemo((function(){return r(r({},l),{},{prefixName:d})}),[l,d]),g=e.useMemo((function(){return{getKey:function(e){var t=d.length,n=e[t];return[c.keys[n],e.slice(t+1)]}}}),[d]);return"function"!=typeof s?(h(!1,"Form.List only accepts function as children."),null):e.createElement(Q.Provider,{value:g},e.createElement(E.Provider,{value:f},e.createElement(Y,{name:[],shouldUpdate:function(e,t,n){return"internal"!==n.source&&e!==t},rules:o,validateTrigger:u,initialValue:a,isList:!0},(function(e,t){var r=e.value,i=void 0===r?[]:r,a=e.onChange,o=l.getFieldValue,u=function(){return o(d||[])||[]},f={add:function(e,t){var r=u();t>=0&&t<=r.length?(c.keys=[].concat(n(c.keys.slice(0,t)),[c.id],n(c.keys.slice(t))),a([].concat(n(r.slice(0,t)),[e],n(r.slice(t))))):(c.keys=[].concat(n(c.keys),[c.id]),a([].concat(n(r),[e]))),c.id+=1},remove:function(e){var t=u(),n=new Set(Array.isArray(e)?e:[e]);n.size<=0||(c.keys=c.keys.filter((function(e,t){return!n.has(t)})),a(t.filter((function(e,t){return!n.has(t)}))))},move:function(e,t){if(e!==t){var n=u();e<0||e>=n.length||t<0||t>=n.length||(c.keys=j(c.keys,e,t),a(j(n,e,t)))}}},g=i||[];return Array.isArray(g)||(g=[]),s(g.map((function(e,t){var n=c.keys[t];return void 0===n&&(c.keys[t]=c.id,n=c.keys[t],c.id+=1),{name:t,key:n,isListField:!0}})),f,t)}))))},ue.useForm=re,ue.useWatch=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n[0],a=void 0===i?[]:i,s=n[1],o=e.useState(),u=v(o,2),l=u[0],c=u[1],d=e.useMemo((function(){return oe(l)}),[l]),f=e.useRef(d);f.current=d;var g=e.useContext(E),h=s||g,m=h&&h._init,p=x(a),F=e.useRef(p);return F.current=p,e.useEffect((function(){if(m){var e=h.getFieldsValue,t=(0,(0,h.getInternalHooks)(V).registerWatch)((function(e){var t=N(e,F.current),n=oe(t);f.current!==n&&(f.current=n,c(t))})),n=N(e(),F.current);return c(n),t}}),[m]),l};export{ae as F,A as s};
